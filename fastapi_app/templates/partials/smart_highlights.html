{% if memory.smart_data %}
<!-- Smart Highlights Section -->
<section class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div
        class="bg-white/80 dark:bg-white/5 backdrop-blur-xl rounded-3xl p-8 border border-slate-200 dark:border-white/10 shadow-2xl relative overflow-hidden group hover:border-slate-300 dark:hover:border-white/20 transition-all duration-500">

        <!-- Decorative Background Elements -->
        <div
            class="absolute top-0 right-0 w-64 h-64 bg-pink-500/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2">
        </div>
        <div
            class="absolute bottom-0 left-0 w-64 h-64 bg-purple-500/10 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2">
        </div>

        <!-- Section Header with Vibe -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4">
            <div>
                <h3
                    class="text-2xl font-display font-bold bg-gradient-to-r from-pink-500 to-purple-500 bg-clip-text text-transparent">
                    Rate The Date âœ¨
                </h3>
                <p class="text-slate-600 dark:text-white/60 text-sm mt-1">AI-Extract Itinerary & Highlights</p>
            </div>

            <div class="flex gap-3">
                {% if memory.smart_data.vibe %}
                <div
                    class="px-6 py-2 rounded-full bg-gradient-to-r from-pink-500/10 to-purple-500/10 border border-pink-500/20 backdrop-blur-md flex items-center gap-2 shadow-[0_0_15px_rgba(236,72,153,0.1)] animate-pulse-slow">
                    <span class="text-2xl">{{ memory.smart_data.vibe.split(' ')[-1] }}</span>
                    <span class="text-pink-600 dark:text-pink-100 font-medium tracking-wide">{{
                        memory.smart_data.vibe.rsplit(' ', 1)[0] }}</span>
                </div>
                {% endif %}

                <!-- Display Shaila's Rating if exists -->
                {% if memory.shaila_rating %}
                <div
                    class="px-6 py-2 rounded-full bg-green-500/10 border border-green-500/20 backdrop-blur-md flex items-center gap-2">
                    <span class="material-icons text-green-500">verified</span>
                    <span class="text-green-600 dark:text-green-300 font-medium">Rated by Shaila</span>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 md:gap-12">

            <!-- Shaila's Rating Section (Appears at top on mobile, right on desktop override) -->
            <div class="lg:col-span-3 mb-8">
                {% if memory.shaila_rating %}
                <!-- Display Saved Rating -->
                <div id="shaila-rating-display" class="transition-all duration-300">
                    <div
                        class="bg-gradient-to-br from-pink-50 to-purple-50 dark:from-pink-900/20 dark:to-purple-900/20 rounded-2xl p-6 border border-pink-100 dark:border-pink-500/20 relative group/rating">

                        <!-- Edit Button (Visible on Hover/Always on mobile) -->
                        <button
                            onclick="document.getElementById('shaila-rating-display').classList.add('hidden'); document.getElementById('shaila-rating-form').classList.remove('hidden');"
                            class="absolute top-4 right-4 p-2 rounded-full bg-white/50 dark:bg-black/20 text-slate-400 hover:text-pink-500 hover:bg-white dark:hover:bg-black/40 transition-all opacity-0 group-hover/rating:opacity-100"
                            title="Edit Rating">
                            <span class="material-icons text-sm">edit</span>
                        </button>

                        <div class="flex items-center gap-3 mb-4">
                            <div
                                class="w-10 h-10 rounded-full bg-pink-500 flex items-center justify-center text-white font-bold">
                                S</div>
                            <div>
                                <h4 class="font-bold text-slate-800 dark:text-white">Shaila's Review</h4>
                                <span class="text-xs text-slate-500 dark:text-white/60">{{
                                    memory.shaila_rating.timestamp
                                    }}</span>
                            </div>
                        </div>
                        <p class="text-slate-700 dark:text-white/90 italic mb-6">"{{ memory.shaila_rating.comment }}"
                        </p>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center p-3 bg-white/50 dark:bg-black/20 rounded-xl">
                                <span class="block text-xs text-slate-500 dark:text-white/60 mb-1">Fun</span>
                                <span class="text-xl font-bold text-pink-600 dark:text-pink-400">{{
                                    memory.shaila_rating.fun
                                    }}/10</span>
                            </div>
                            <div class="text-center p-3 bg-white/50 dark:bg-black/20 rounded-xl">
                                <span class="block text-xs text-slate-500 dark:text-white/60 mb-1">Food</span>
                                <span class="text-xl font-bold text-orange-600 dark:text-orange-400">{{
                                    memory.shaila_rating.food }}/10</span>
                            </div>
                            <div class="text-center p-3 bg-white/50 dark:bg-black/20 rounded-xl">
                                <span class="block text-xs text-slate-500 dark:text-white/60 mb-1">Vibe</span>
                                <span class="text-xl font-bold text-purple-600 dark:text-purple-400">{{
                                    memory.shaila_rating.vibe }}/10</span>
                            </div>
                            <div class="text-center p-3 bg-white/50 dark:bg-black/20 rounded-xl">
                                <span class="block text-xs text-slate-500 dark:text-white/60 mb-1">Romance</span>
                                <span class="text-xl font-bold text-red-600 dark:text-red-400">{{
                                    memory.shaila_rating.romance }}/10</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hidden Edit Form -->
                <div id="shaila-rating-form" class="hidden transition-all duration-300">
                    <div
                        class="bg-slate-50 dark:bg-white/5 rounded-2xl p-6 border border-slate-200 dark:border-white/10 relative">
                        <!-- Cancel Button -->
                        <button
                            onclick="document.getElementById('shaila-rating-form').classList.add('hidden'); document.getElementById('shaila-rating-display').classList.remove('hidden');"
                            class="absolute top-4 right-4 p-2 text-slate-400 hover:text-red-500 transition-colors"
                            title="Cancel Editing">
                            <span class="material-icons">close</span>
                        </button>

                        <h4 class="font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2">
                            <span class="material-icons text-pink-500">edit_note</span>
                            Update Rating
                        </h4>
                        <form action="/rate_date/{{ memory.id }}" method="post">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <!-- Fun Slider -->
                                <div>
                                    <label
                                        class="flex justify-between text-sm font-medium text-slate-600 dark:text-white/80 mb-2">
                                        Fun Factor <span class="text-pink-500" id="val-fun-edit">{{
                                            memory.shaila_rating.fun }}</span>
                                    </label>
                                    <input type="range" name="fun" min="0" max="10"
                                        value="{{ memory.shaila_rating.fun }}"
                                        class="w-full accent-pink-500 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer"
                                        oninput="document.getElementById('val-fun-edit').innerText = this.value">
                                </div>
                                <!-- Food Slider -->
                                <div>
                                    <label
                                        class="flex justify-between text-sm font-medium text-slate-600 dark:text-white/80 mb-2">
                                        Food Rating <span class="text-orange-500" id="val-food-edit">{{
                                            memory.shaila_rating.food }}</span>
                                    </label>
                                    <input type="range" name="food" min="0" max="10"
                                        value="{{ memory.shaila_rating.food }}"
                                        class="w-full accent-orange-500 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer"
                                        oninput="document.getElementById('val-food-edit').innerText = this.value">
                                </div>
                                <!-- Vibe Slider -->
                                <div>
                                    <label
                                        class="flex justify-between text-sm font-medium text-slate-600 dark:text-white/80 mb-2">
                                        Vibe Check <span class="text-purple-500" id="val-vibe-edit">{{
                                            memory.shaila_rating.vibe }}</span>
                                    </label>
                                    <input type="range" name="vibe" min="0" max="10"
                                        value="{{ memory.shaila_rating.vibe }}"
                                        class="w-full accent-purple-500 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer"
                                        oninput="document.getElementById('val-vibe-edit').innerText = this.value">
                                </div>
                                <!-- Romance Slider -->
                                <div>
                                    <label
                                        class="flex justify-between text-sm font-medium text-slate-600 dark:text-white/80 mb-2">
                                        Romance Level <span class="text-red-500" id="val-romance-edit">{{
                                            memory.shaila_rating.romance }}</span>
                                    </label>
                                    <input type="range" name="romance" min="0" max="10"
                                        value="{{ memory.shaila_rating.romance }}"
                                        class="w-full accent-red-500 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer"
                                        oninput="document.getElementById('val-romance-edit').innerText = this.value">
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="block text-sm font-medium text-slate-600 dark:text-white/80 mb-2">Shaila's
                                    Comments</label>
                                <textarea name="comment" rows="3"
                                    class="w-full px-4 py-2 rounded-xl bg-white dark:bg-black/20 border border-slate-200 dark:border-white/10 text-slate-800 dark:text-white focus:ring-2 focus:ring-pink-500 outline-none transition-all"
                                    placeholder="How did it really go? ðŸ˜‰">{{ memory.shaila_rating.comment }}</textarea>
                            </div>

                            <button type="submit"
                                class="w-full py-2 bg-pink-500 hover:bg-pink-600 text-white font-medium rounded-xl shadow-lg shadow-pink-500/30 transition-all transform hover:scale-[1.02]">
                                Update Rating
                            </button>
                        </form>
                    </div>
                </div>
                {% else %}
                <!-- Rating Form -->
                <div class="bg-slate-50 dark:bg-white/5 rounded-2xl p-6 border border-slate-200 dark:border-white/10">
                    <h4 class="font-bold text-slate-800 dark:text-white mb-4 flex items-center gap-2">
                        <span class="material-icons text-pink-500">rate_review</span>
                        Rate this Date (Shaila's Version)
                    </h4>
                    <form action="/rate_date/{{ memory.id }}" method="post">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <!-- Fun Slider -->
                            <div>
                                <label
                                    class="flex justify-between text-sm font-medium text-slate-600 dark:text-white/80 mb-2">
                                    Fun Factor <span class="text-pink-500" id="val-fun">5</span>
                                </label>
                                <input type="range" name="fun" min="0" max="10" value="5"
                                    class="w-full accent-pink-500 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer"
                                    oninput="document.getElementById('val-fun').innerText = this.value">
                            </div>
                            <!-- Food Slider -->
                            <div>
                                <label
                                    class="flex justify-between text-sm font-medium text-slate-600 dark:text-white/80 mb-2">
                                    Food Rating <span class="text-orange-500" id="val-food">5</span>
                                </label>
                                <input type="range" name="food" min="0" max="10" value="5"
                                    class="w-full accent-orange-500 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer"
                                    oninput="document.getElementById('val-food').innerText = this.value">
                            </div>
                            <!-- Vibe Slider -->
                            <div>
                                <label
                                    class="flex justify-between text-sm font-medium text-slate-600 dark:text-white/80 mb-2">
                                    Vibe Check <span class="text-purple-500" id="val-vibe">5</span>
                                </label>
                                <input type="range" name="vibe" min="0" max="10" value="5"
                                    class="w-full accent-purple-500 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer"
                                    oninput="document.getElementById('val-vibe').innerText = this.value">
                            </div>
                            <!-- Romance Slider -->
                            <div>
                                <label
                                    class="flex justify-between text-sm font-medium text-slate-600 dark:text-white/80 mb-2">
                                    Romance Level <span class="text-red-500" id="val-romance">5</span>
                                </label>
                                <input type="range" name="romance" min="0" max="10" value="5"
                                    class="w-full accent-red-500 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer"
                                    oninput="document.getElementById('val-romance').innerText = this.value">
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-600 dark:text-white/80 mb-2">Shaila's
                                Comments</label>
                            <textarea name="comment" rows="3"
                                class="w-full px-4 py-2 rounded-xl bg-white dark:bg-black/20 border border-slate-200 dark:border-white/10 text-slate-800 dark:text-white focus:ring-2 focus:ring-pink-500 outline-none transition-all"
                                placeholder="How did it really go? ðŸ˜‰"></textarea>
                        </div>

                        <button type="submit"
                            class="w-full py-2 bg-pink-500 hover:bg-pink-600 text-white font-medium rounded-xl shadow-lg shadow-pink-500/30 transition-all transform hover:scale-[1.02]">
                            Submit Rating
                        </button>
                    </form>
                </div>
                {% endif %}
            </div>


            <!-- Column 1: Itinerary Timeline -->
            <div class="lg:col-span-2 space-y-6">
                <h4 class="text-lg font-medium text-slate-800 dark:text-white/90 flex items-center gap-2 mb-4">
                    <span class="material-icons text-pink-500">timeline</span>
                    The Day's Journey
                </h4>

                <div class="relative pl-4 border-l-2 border-slate-200 dark:border-white/10 space-y-8 ml-2">
                    {% for item in memory.smart_data.itinerary %}
                    {% if item.item %}
                    <div class="relative group/item">
                        <!-- Timeline Dot -->
                        <div
                            class="absolute -left-[25px] top-1 w-4 h-4 rounded-full border-2 border-white bg-slate-200 dark:bg-slate-800 dark:border-white/10 group-hover/item:border-pink-500 group-hover/item:bg-pink-500 transition-all duration-300 shadow-md">
                        </div>

                        <div
                            class="bg-white/50 dark:bg-white/5 hover:bg-white/80 dark:hover:bg-white/10 p-4 rounded-xl border border-slate-200 dark:border-white/5 hover:border-pink-200 dark:hover:border-white/20 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg">
                            <div class="flex items-start gap-4">
                                <div class="p-2 rounded-lg bg-pink-50 dark:bg-white/5 text-pink-600 dark:text-pink-300">
                                    <span class="material-icons sm-icon">{{ item.icon or 'event' }}</span>
                                </div>
                                <div>
                                    <p class="text-slate-700 dark:text-white/90 text-lg leading-relaxed">{{ item.item }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>

            <!-- Column 2: Highlights Cards -->
            <div class="space-y-6">

                <!-- Food Highlights -->
                {% if memory.smart_data.entities.food %}
                <div
                    class="bg-white/50 dark:bg-white/5 rounded-2xl p-6 border border-slate-200 dark:border-white/10 shadow-sm">
                    <h4 class="text-lg font-medium text-slate-800 dark:text-white/90 flex items-center gap-2 mb-4">
                        <span class="material-icons text-orange-500">restaurant_menu</span>
                        On The Menu
                    </h4>
                    <div class="flex flex-wrap gap-2">
                        {% for food in memory.smart_data.entities.food %}
                        <span
                            class="px-3 py-1.5 rounded-lg bg-orange-100 dark:bg-orange-500/10 border border-orange-200 dark:border-orange-500/20 text-orange-700 dark:text-orange-200 text-sm hover:bg-orange-200 dark:hover:bg-orange-500/20 transition-colors">
                            {{ food }}
                        </span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Places Highlights -->
                {% if memory.smart_data.entities.places %}
                <div
                    class="bg-white/50 dark:bg-white/5 rounded-2xl p-6 border border-slate-200 dark:border-white/10 shadow-sm">
                    <h4 class="text-lg font-medium text-slate-800 dark:text-white/90 flex items-center gap-2 mb-4">
                        <span class="material-icons text-blue-500">place</span>
                        Places Visited
                    </h4>
                    <div class="flex flex-wrap gap-2">
                        {% for place in memory.smart_data.entities.places %}
                        <span
                            class="px-3 py-1.5 rounded-lg bg-blue-100 dark:bg-blue-500/10 border border-blue-200 dark:border-blue-500/20 text-blue-700 dark:text-blue-200 text-sm hover:bg-blue-200 dark:hover:bg-blue-500/20 transition-colors flex items-center gap-1">
                            <span class="material-icons text-[14px]">pin_drop</span>
                            {{ place }}
                        </span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

            </div>
        </div>
    </div>
</section>
{% endif %}